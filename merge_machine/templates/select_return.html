<html>
    <head>
        <title>Select return</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/themes/github.css">
 
        <!--<link rel="stylesheet" type="text/css" href="http://www.csszengarden.com/219/219.css?v=8may2013">-->
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script type="text/javascript" charset="utf-8">

	        var orig_color = '#ffffff'
	        var color_selected = '#5697ff'

	        var label = {
			    {% for col in ref_index %}
			    		"{{ col }}": false,
			    {% endfor %}
	        }	
	       
	       	$(document).ready(function() {
				{% for col in selected_columns_to_return %}
					label["{{ col }}"] = true
					$("#ref_table .{{ col }}").css('background-color', color_selected) 
				{% endfor %}
			});


			function update_color_and_label(col) {
	        	label[col] = !label[col] 
		        // Change color
	        	if (label[col]){
	        		$("#ref_table .".concat(col)).css('background-color', color_selected)
	        	} else {
	        		$("#ref_table .".concat(col)).css('background-color', orig_color)
	        	}				
			}


			$("#ref_table").ready(function() {
				{% for col in ref_index %}
			        $("#ref_table .{{ col }}").on("click", function() {
			        	update_color_and_label("{{ col }}")
			        });
			        $("#ref_table .ALL_XYZ").on("click", function() {
			        	update_color_and_label("{{ col }}")
			        });
		        {% endfor %}
	    	});
	        
	        $(document).ready(function(){

				$("#submitBtn").on("click", function() {
					// http://blog.w3villa.com/websites/uploading-filesimage-with-ajax-jquery-without-submitting-a-form/
					// Select source

		        	json_to_send = []
		        	for (var col in label) {
		        		if (label[col]) {
		        			json_to_send.push(col)
		        		}
		        	}

		    		$.ajax({
		            type: 'post',
			            url: "{{ select_return_api_url }}",
			            data: JSON.stringify(json_to_send),
			            contentType: "application/json; charset=utf-8",
			            traditional: true,
			            success: function (data) {
			            	alert(JSON.stringify(json_to_send))
			            	window.location = "{{ next_url }}"
			            }
		        	});
		        });
			});



        </script>
    </head>


    <body>
        <h1 id='title'>Select columns from referential to return: {{ project_id }}</h1>

		<div style="width: 100%;">
			 <!-- SELECT REF -->
			 <div style="float:left;">
			 	<h2 id='title'>Referential</h2>

				<table id="ref_table" style="font-size: 75%;">
					{% for col in ref_index %}
						<tr>
							<td> <input type="checkbox" name="{{ col }}" value="{{ col }}"> </td>
							<th class="{{ col }}">{{ col }}</th>
							{% for row in ref_sample %}
								<td class="{{ col }}">{{ row[col] }}</td>
							{% endfor %}
						</tr>
					{% endfor %}
					<tr>
						<th class="ALL_XYZ">ALL</th>
					</tr>
				 </table>

			</div>

			<div style="clear:both">

				</br>
				<button type="button" id="submitBtn" >Next Step...</button>
			</div>
		</div>
	
    </body>
</html>


